import streamlit as st
import yfinance as yf
import pandas as pd

@st.cache_data(ttl=3600)  # Melhoria 5: Cache para não travar o app a cada clique
def get_price_history(ticker, period="5y"):
    """Busca histórico de preços e trata erros de ativos brasileiros."""
    try:
        # Garante que tickers brasileiros tenham o .SA
        if not ticker.endswith(".SA") and len(ticker) <= 6:
            # Tenta adicionar .SA se for um ticker curto (ex: PETR4)
            ticker_search = f"{ticker.upper()}.SA"
        else:
            ticker_search = ticker.upper()
            
        data = yf.download(ticker_search, period=period)
        
        if data.empty:
            return None
            
        # Retorna apenas o preço de fechamento ajustado
        return data["Adj Close"]
    except Exception as e:
        print(f"Erro ao buscar {ticker}: {e}")
        return None
